<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
		<style type="text/css">
			.contrast_table {
				border-collapse: collapse;
				/* 边框合并属性  */
			}
			
			.contrast_table td,
			.contrast_table th {
				padding: 12px;
				border: 1px solid #eee;
			}
			
			.contrast_table .good_detail {}
			
			.contrast_table .good_detail {}
		</style>
		<title></title>

	</head>

	<body>
		<table class="contrast_table" cellpadding="0" cellspacing="0">
			<tbody class="attr_detail">
				<!--                 
				<tr class="goods_detail" id="goods_detail_name"></tr>
				<tr class="attr_type" id="attr_type_index_1"></tr>
				<tr class="attr_item attr_type_index_1" id="attr_item_index_1" ></tr>
				<tr class="attr_item attr_type_index_1" id="attr_item_index_2"></tr>
				-->
			</tbody>
		</table>
		<script src="../../lib/jQuery/jquery-2.2.2.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				getPageData();
				setOnclickAttrTypeEvent();
			});

			function getPageData() {
				$.ajax({
					type: "get",
					url: "../../data/index.txt",
					async: true,
					dataType: "html",
					success: function(data) {
						console.log(2222)
						data = eval(data);
						initPage(data);
					},
					complete: function(XHR, TS) {
						console.log(1111)
					}
				});
			}

			function setOnclickAttrTypeEvent(){
				$(".attr_detail").on("click",".attr_type",function(){
					var thisId = this.id;
					$("."+thisId).toggle();
				});
			}

			function initPage(data) {
				var attrTypeIndex = 0;
				var attrType = "";
				var navigationData = [];
				var $goodsTR = $(document.createElement("tr")); //<tr class="goods_detail" id="goods_detail_name"></tr>
				$goodsTR.addClass("goods_detail");
				var $tBody = $(".attr_detail");
				$tBody.append($goodsTR);
				for (var i = 0, len = data.length; i < len; i++) {
					//获取th固定列部分。
					var obj = data[i];
					if (i == 0) {
						var $goodTH = $(document.createElement("th"));
						$goodTH.html("产品名称");
						$goodsTR.append($goodTH);
					}
					var $goodTD = $(document.createElement("td"));
					$goodTD.html((obj.goods).name);
					$goodsTR.append($goodTD);
					for (var j = 0, jLen = (obj.attr).length; j < jLen; j++) {
						var objAttr = (obj.attr)[j];
						if (attrType != objAttr.attrType && i == 0) { //找到分类
							navigationData.push({
								"typeindex": attrTypeIndex,
								"typename": objAttr.attrType
							});
							var $typeTR = $(document.createElement("tr")).addClass("attr_type").attr("id", "attr_type_index_" + attrTypeIndex); //<tr class="attr_type" id="attr_type_index_1"></tr>
							var $typeTD = $(document.createElement("td")).attr("colspan", len+1).html(objAttr.attrType);
							$typeTR.append($typeTD);
							attrTypeIndex += 1;
							attrType = objAttr.attrType;
							$tBody.append($typeTR);
						}
						//	<tr class="attr_item attr_type_index_1" id="attr_item_index_1" ></tr>
						var $attrTR;
						if (i == 0) {
							$attrTR = $(document.createElement("tr")).addClass("attr_item "+"attr_type_index_" + (attrTypeIndex - 1)).attr("id", "attr_item_index_" + j);
							var $attrTH = $(document.createElement("th")).html(objAttr.attrKey);
							$attrTR.append($attrTH);
							$tBody.append($attrTR);
						} else {
							$attrTR = $("#attr_item_index_" + j);
						}
						var $attrTD = $(document.createElement("td")).html(objAttr.attrValue);
						$attrTR.append($attrTD);
					}
				}
			}
		</script>
	</body>

</html>